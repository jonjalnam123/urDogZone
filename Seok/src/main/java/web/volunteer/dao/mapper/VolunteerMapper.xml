<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DTD -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="web.volunteer.dao.face.VolunteerDao">

	<select id="getVolunteerList" parameterType="Paging" resultType="VolunteerDTO">
		/* VolunteerDao.getVolunteerList */
		SELECT A.VOLUNTEER_CD
				, A.PLACE_CD
		        , B.PLACE_NM
				, A.VOLUNTEER_TITLE
				, A.VOLUNTEER_NOTE
				, A.VOLUNTEER_MAX_CNT
				, A.VOLUNTEER_DT
				, A.REG_ID
				, DATE_FORMAT(A.REG_DT, '%Y-%m-%d') AS REG_DT
				, A.UPD_ID
				, DATE_FORMAT(A.UPD_DT, '%Y-%m-%d') AS UPD_DT
		  FROM TB_VOLUNTEER_INFO A
		  INNER JOIN TB_PLACE_INFO B
		     ON A.PLACE_CD = B.PLACE_CD
	     WHERE A.VOLUNTEER_DEL_YN = 'N'
		 ORDER BY A.VOLUNTEER_DT DESC
		  LIMIT #{startNo}, #{endNo}
	</select>
	
   	<select id="volunteerList" parameterType="map" resultType="VolunteerDTO">
		/* VolunteerDao.volunteerList */
		SELECT A.VOLUNTEER_CD
				, A.PLACE_CD
		        , B.PLACE_NM
				, A.VOLUNTEER_TITLE
				, A.VOLUNTEER_NOTE
				, A.VOLUNTEER_MAX_CNT
				, A.VOLUNTEER_DT
				, A.REG_ID
				, DATE_FORMAT(A.REG_DT, '%Y-%m-%d') AS REG_DT
				, A.UPD_ID
				, DATE_FORMAT(A.UPD_DT, '%Y-%m-%d') AS UPD_DT
		  FROM TB_VOLUNTEER_INFO A
		  INNER JOIN TB_PLACE_INFO B
		     ON A.PLACE_CD = B.PLACE_CD
	    WHERE A.VOLUNTEER_DEL_YN = 'N'
	        <if test="searchDTO.param != null and searchDTO.param != ''">
	             AND A.VOLUNTEER_LOCATE_CITY_CD LIKE CONCAT('%', #{searchDTO.param}, '%') 
	        </if>
	        <if test="searchDTO.param1 != null and searchDTO.param1 != ''">
	            AND A.VOLUNTEER_TITLE LIKE CONCAT('%', #{searchDTO.param1}, '%')
	        </if>
		ORDER BY A.VOLUNTEER_DT DESC
		 LIMIT #{paging.startNo}, #{paging.endNo}
	</select>
	
	<insert id="regVolunteerList" parameterType="VolunteerDTO">
		/* VolunteerDao.regVolunteerList */
		INSERT INTO TB_VOLUNTEER_INFO (
		   PLACE_CD
		 , VOLUNTEER_TITLE
		 , VOLUNTEER_NOTE
		 , VOLUNTEER_MAX_CNT
		 , VOLUNTEER_DT
		 , VOLUNTEER_DEL_YN
		 , REG_ID
		 , REG_DT
		 , UPD_ID
		 , UPD_DT
		) 
		VALUES (
		   #{placeCd}
		 , #{volunteerTitle}
		 , #{volunteerNote}
		 , #{volunteerMaxCnt}
		 , #{volunteerDt}
		 , 'N'
		 , #{regId}
		 , SYSDATE()
		 , #{updId}
		 , SYSDATE()
		)
	</insert>
	
   	<select id="getVolunteerListDetail" parameterType="int" resultType="VolunteerDTO">
		/* VolunteerDao.getVolunteerListDetail */
		SELECT VOLUNTEER_CD
				, PLACE_CD
				, VOLUNTEER_TITLE
				, VOLUNTEER_NOTE
				, VOLUNTEER_MAX_CNT
				, VOLUNTEER_DT
				, VOLUNTEER_DEL_YN
				, REG_ID
				, DATE_FORMAT(REG_DT, '%Y-%m-%d') AS REG_DT
				, UPD_ID
				, DATE_FORMAT(UPD_DT, '%Y-%m-%d') AS UPD_DT
		  FROM TB_VOLUNTEER_INFO
	    WHERE VOLUNTEER_CD = #{volunteerCd}
	       AND VOLUNTEER_DEL_YN = 'N'
	</select>
	
	<update id="updVolunteerList" parameterType="VolunteerDTO">
		/* VolunteerDao.updVolunteerList */
        UPDATE TB_VOLUNTEER_INFO 
			 SET VOLUNTEER_TITLE = #{volunteerTitle}
			     , VOLUNTEER_NOTE = #{volunteerNote}
				 , VOLUNTEER_MAX_CNT = #{volunteerMaxCnt}
			     , VOLUNTEER_DT = #{volunteerDt}
			     , UPD_ID = #{updId}
			     , UPD_DT = SYSDATE()
		  WHERE VOLUNTEER_CD = #{volunteerCd}
	</update>
	
	<update id="delVolunteerList" parameterType="VolunteerDTO">
		/* VolunteerDao.delVolunteerList */
	    UPDATE TB_VOLUNTEER_INFO
	         SET VOLUNTEER_DEL_YN = 'Y'
	     WHERE VOLUNTEER_CD IN 
	    <foreach item="volunteerCd" collection="checkVolCdList" open="(" separator="," close=")">
	        #{volunteerCd}
	    </foreach>
	</update>
	
	<select id="getVolunteerPlaceList" parameterType="Paging" resultType="VolunteerPlaceDTO">
		/* VolunteerDao.getVolunteerPlaceList */
		SELECT A.PLACE_CD
				, A.PLACE_NM
				, B.CITY_NAME
				, B.CITY_CODE
				, A.PLACE_POSTCODE
				, A.PLACE_AD
				, A.PLACE_ADD
				, A.PLACE_NOTE
				, A.FILE_NO
				, A.REG_ID
				, DATE_FORMAT(A.REG_DT, '%Y-%m-%d') AS REG_DT
				, A.UPD_ID
				, DATE_FORMAT(A.UPD_DT, '%Y-%m-%d') AS UPD_DT
		  FROM TB_PLACE_INFO A
		  INNER JOIN TB_KOREA_CITY_INFO B
		     ON  A.CITY_CODE = B.CITY_CODE
		 WHERE A.PLACE_DEL_YN = 'N'
	  ORDER BY B.CITY_CODE ASC 
		  LIMIT #{startNo}, #{endNo}
	</select>
	
   	<select id="volunteerPlaceList" parameterType="map" resultType="VolunteerPlaceDTO">
		/* VolunteerDao.volunteerPlaceList */
		SELECT A.PLACE_CD
				, A.PLACE_NM
				, B.CITY_NAME
				, B.CITY_CODE
				, A.PLACE_POSTCODE
				, A.PLACE_AD
				, A.PLACE_ADD
				, A.PLACE_NOTE
				, A.FILE_NO
				, A.REG_ID
				, DATE_FORMAT(A.REG_DT, '%Y-%m-%d') AS REG_DT
				, A.UPD_ID
				, DATE_FORMAT(A.UPD_DT, '%Y-%m-%d') AS UPD_DT
		  FROM TB_PLACE_INFO A
		  INNER JOIN TB_KOREA_CITY_INFO B
		     ON A.CITY_CODE = B.CITY_CODE
	    WHERE A.PLACE_DEL_YN = 'N'
        <if test="searchDTO.param != null and searchDTO.param != ''">
            AND A.CITY_CODE LIKE CONCAT('%', #{searchDTO.param}, '%')
        </if>
        <if test="searchDTO.param1 != null and searchDTO.param1 != ''">
            AND A.PLACE_NM LIKE CONCAT('%', #{searchDTO.param1}, '%')
        </if>
		ORDER BY B.CITY_CODE ASC
		 LIMIT #{paging.startNo}, #{paging.endNo}
	</select>
	
	<insert id="regVolunteerPlace" parameterType="VolunteerPlaceDTO">
		/* VolunteerDao.regVolunteerPlace */
		INSERT INTO TB_PLACE_INFO (
		   PLACE_NM
		 , PLACE_POSTCODE
		 , PLACE_AD
		 , PLACE_ADD
		 , CITY_CODE
		 , PLACE_NOTE
		 , PLACE_DEL_YN
		 , FILE_NO
		 , REG_ID
		 , REG_DT
		 , UPD_ID
		 , UPD_DT
		) 
		VALUES (
		   #{placeNm}
		 , #{placePostCode}
		 , #{placeAd}
		 , #{placeAdd}
		 , #{cityCode}
		 , #{placeNote}
		 , 'N'
		 , #{fileNo}
		 , #{regId}
		 , SYSDATE()
		 , #{updId}
		 , SYSDATE()
		)
	</insert>
	
   	<select id="getVolunteerPlaceDetail" parameterType="int" resultType="VolunteerPlaceDTO">
		/* VolunteerDao.getVolunteerPlaceDetail */
		SELECT PLACE_CD
				, CITY_CODE
				, PLACE_NM
				, PLACE_POSTCODE
				, PLACE_AD
				, PLACE_ADD
				, PLACE_NOTE
				, FILE_NO
				, REG_ID
				, DATE_FORMAT(REG_DT, '%Y-%m-%d') AS REG_DT
				, UPD_ID
				, DATE_FORMAT(UPD_DT, '%Y-%m-%d') AS UPD_DT
		  FROM TB_PLACE_INFO
	    WHERE PLACE_CD = #{placeCd}
	       AND PLACE_DEL_YN = 'N'
	</select>
	
	<update id="updVolunteerPlace" parameterType="VolunteerPlaceDTO">
		/* VolunteerDao.updVolunteerPlace */
        UPDATE TB_PLACE_INFO 
			 SET PLACE_NM = #{placeNm}
			     , CITY_CODE = #{cityCode}
				 , PLACE_POSTCODE = #{placePostCode}
			     , PLACE_AD = #{placeAd}
			     , PLACE_ADD = #{placeAdd}
			     , PLACE_NOTE = #{placeNote}
			     , UPD_ID = #{updId}
			     , UPD_DT = SYSDATE()
		  WHERE PLACE_CD = #{placeCd}
	</update>

	<update id="delVolunteerPlace" parameterType="VolunteerPlaceDTO">
		/* VolunteerDao.delVolunteerPlace */
	    UPDATE TB_PLACE_INFO
	         SET PLACE_DEL_YN = 'Y'
	     WHERE PLACE_CD IN
	    <foreach item="placeCd" collection="checkPlaceCdList" open="(" separator="," close=")">
	        #{placeCd}
	    </foreach>
	</update>

</mapper>